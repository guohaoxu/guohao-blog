/**
 * imgcrop jQuery plugin
 * version 1.0
 * Copyright (c) 2015 guohao
 * https://github.com/guohaoxu/imgcrop
 */
!function(a){"use strict";function g(){this._default={init:!1,views:[],onSelectChange:null,onSelectEnd:null}}var f,b=Math.abs,d=(Math.max,Math.min),e=Math.round;a.extend(g.prototype,{propertyName:"imgcrop",markerClassName:"hasImgcrop",_destroyImgcrop:function(b){var d=(a(window),a(document));a("body"),b=a(b),b.hasClass(this.markerClassName)&&(b.removeClass(this.markerClassName),d.off("."+b.propertyName),b.data("imgcrop_bg").hide(),b.data("imgcrop").hide(),b.data("imgcrop_border").hide(),b.off("dragstart"))},_attachImgcrop:function(c,f){function D(){var b,d;if(v.imgWid=c.width(),v.imgHei=c.height(),v.wid=v.hei=c.data("imgcrop").width(),v.x1=c.data("imgcrop").offset().left-c.offset().left,v.y1=c.data("imgcrop").offset().top-c.offset().top,v.x2=v.x1+v.wid,v.y2=v.y1+v.hei,b=w.imgWid/v.imgWid,w.wid=w.hei=e(v.wid*b),w.x1=e(v.x1*b),w.y1=e(v.y1*b),w.x2=e(v.x2*b),w.y2=e(v.y2*b),c.data({imgcrop_x1:w.x1,imgcrop_y1:w.y1,imgcrop_WH:w.wid,imgcrop_x2:w.x2,imgcrop_y2:w.y2}),f.views.length>0)for(d=0;d<f.views.length;d++)a(f.views[d].view).width(f.views[d].view_WH/v.wid*v.imgWid),a(f.views[d].view).height(f.views[d].view_WH/v.hei*v.imgHei),a(f.views[d].view).css("margin-left",-(f.views[d].view_WH/v.wid*v.x1)),a(f.views[d].view).css("margin-top",-(f.views[d].view_WH/v.hei*v.y1));c.on("dragstart",!1),c.data("imgcrop").css("user-select","none").on("selectstart",!1),c.data("imgcrop").children("img").css("user-select","none").on("selectstart",!1).on("dragstart",!1),c.data("imgcrop_border").css("user-select","none").on("selectstart",!1),i.css("user-select","none").on("selectstart",!1),y=c.data("imgcrop").offset().top-c.offset().top,z=c.data("imgcrop").offset().left-c.offset().left,a.isFunction(f.onSelectChange)&&f.onSelectChange.apply(c,[])}function E(a,d,e){x=parseInt(c.data("imgcrop_border").css("borderRightWidth"),10),k=b(a.pageX-d)<b(a.pageY-e)?b(a.pageY-e):b(a.pageX-d),a.pageX>d&&a.pageY<e?(e-k<c.offset().top&&(k=e-c.offset().top),d+k>c.offset().left+c.width()&&(k=c.offset().left+c.width()-d),c.data("imgcrop").css({top:e-k,left:d}),c.data("imgcrop_border").css({top:e-k-x,left:d-x})):a.pageX>d&&a.pageY>e?(e+k>c.offset().top+c.height()&&(k=c.offset().top+c.height()-e),d+k>c.offset().left+c.width()&&(k=c.offset().left+c.width()-d),c.data("imgcrop").css({top:e,left:d}),c.data("imgcrop_border").css({top:e-x,left:d-x})):a.pageX<d&&a.pageY>e?(e+k>c.offset().top+c.height()&&(k=c.offset().top+c.height()-e),d-k<c.offset().left&&(k=d-c.offset().left),c.data("imgcrop").css({top:e,left:d-k}),c.data("imgcrop_border").css({top:e-x,left:d-k-x})):a.pageX<d&&a.pageY<e&&(e-k<c.offset().top&&(k=e-c.offset().top),d-k<c.offset().left&&(k=d-c.offset().left),c.data("imgcrop").css({top:e-k,left:d-k}),c.data("imgcrop_border").css({top:e-k-x,left:d-k-x})),c.data("imgcrop").css({width:k,height:k}),c.data("imgcrop_border").css({width:k,height:k}),c.data("imgcrop").children("img").css({top:c.offset().top-c.data("imgcrop").offset().top,left:c.offset().left-c.data("imgcrop").offset().left}),D(c)}function F(a){var b=c.get(0).initX,d=c.get(0).initY,e=a.pageX-c.get(0).dragX,f=a.pageY-c.get(0).dragY;c.data("imgcrop").css({left:b+e,top:d+f}),c.data("imgcrop_border").css({left:b+e-x,top:d+f-x}),c.data("imgcrop").offset().left+k>c.offset().left+c.width()&&(c.data("imgcrop").css("left",c.offset().left+c.width()-k),c.data("imgcrop_border").css("left",c.offset().left+c.width()-k-x)),c.data("imgcrop").offset().left<c.offset().left&&(c.data("imgcrop").css("left",c.offset().left),c.data("imgcrop_border").css("left",c.offset().left-x)),c.data("imgcrop").offset().top+k>c.offset().top+c.height()&&(c.data("imgcrop").css("top",c.offset().top+c.height()-k),c.data("imgcrop_border").css("top",c.offset().top+c.height()-k-x)),c.data("imgcrop").offset().top<c.offset().top&&(c.data("imgcrop").css("top",c.offset().top),c.data("imgcrop_border").css("top",c.offset().top-x)),c.data("imgcrop").children("img").css({top:c.offset().top-c.data("imgcrop").offset().top,left:c.offset().left-c.data("imgcrop").offset().left}),D(c)}function G(a){"fixed"==a?g.on("scroll",function(){c.data("imgcrop").css({left:c.offset().left+z,top:c.offset().top+y}),c.data("imgcrop_border").css({left:c.offset().left+z-x,top:c.offset().top+y-x}),c.data("imgcrop_bg").css({left:c.offset().left,top:c.offset().top})}):"resize"==a&&(c.data("imgcrop").css({left:c.offset().left+z,top:c.offset().top+y}),c.data("imgcrop_border").css({left:c.offset().left+z-x,top:c.offset().top+y-x}),c.data("imgcrop_bg").css({left:c.offset().left,top:c.offset().top}))}function H(a){(0===a.button||1===a.button&&document.all&&!document.addEventListener)&&(a.pageX>c.offset().left&&a.pageX<c.offset().left+c.width()&&a.pageY>c.offset().top&&a.pageY<c.offset().top+c.height()?0===k?(l=!0,c.data("imgcrop_img").width(c.width()),c.data("imgcrop").css({left:a.pageX,top:a.pageY,width:0,height:0}).show(),c.data("imgcrop_border").css({left:a.pageX,top:a.pageY,width:0,height:0}).show(),c.data("imgcrop_bg").css({left:c.offset().left,top:c.offset().top,width:c.width(),height:c.height()}).show(),c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top):a.pageX>c.data("imgcrop").offset().left+5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()-5&&a.pageY>c.data("imgcrop").offset().top+5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()-5?(m=!0,c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).dragX=a.pageX,c.get(0).dragY=a.pageY):a.pageX>c.data("imgcrop").offset().left&&a.pageX<c.data("imgcrop").offset().left+5&&a.pageY>c.data("imgcrop").offset().top+5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()-5?(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k,o=!0,r=!0):a.pageY>c.data("imgcrop").offset().top&&a.pageY<c.data("imgcrop").offset().top+5&&a.pageX>c.data("imgcrop").offset().left+5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()-5?(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k,p=!0,s=!0):a.pageX>c.data("imgcrop").offset().left+c.data("imgcrop").width()-5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()&&a.pageY>c.data("imgcrop").offset().top+5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()-5?(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k,n=!0,t=!0):a.pageY>c.data("imgcrop").offset().top+c.data("imgcrop").height()-5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()&&a.pageX>c.data("imgcrop").offset().left+5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()-5?(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k,n=!0,u=!0):n||o||p||q?(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k):(A=!0,B=!0,c.get(0).initX=a.pageX,c.get(0).initY=a.pageY):(n||o||p||q)&&(c.get(0).initX=c.data("imgcrop").offset().left,c.get(0).initY=c.data("imgcrop").offset().top,c.get(0).tempWH=k))}function I(a){k>0&&(r?i.css("cursor","w-resize"):s?i.css("cursor","n-resize"):t?i.css("cursor","e-resize"):u?i.css("cursor","s-resize"):a.pageX>c.data("imgcrop").offset().left+5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()-5&&a.pageY>c.data("imgcrop").offset().top+5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()-5?i.css("cursor","move"):a.pageX>c.data("imgcrop").offset().left+1&&a.pageX<c.data("imgcrop").offset().left+5?(i.css("cursor","w-resize"),o&&i.css("cursor","w-resize")):a.pageX>c.data("imgcrop").offset().left+c.data("imgcrop").width()-5&&a.pageX<c.data("imgcrop").offset().left+c.data("imgcrop").width()-1?(i.css("cursor","e-resize"),n&&i.css("cursor","e-resize")):a.pageY>c.data("imgcrop").offset().top+1&&a.pageY<c.data("imgcrop").offset().top+5?(i.css("cursor","n-resize"),p&&i.css("cursor","n-resize")):a.pageY>c.data("imgcrop").offset().top+c.data("imgcrop").height()-5&&a.pageY<c.data("imgcrop").offset().top+c.data("imgcrop").height()-1?(i.css("cursor","s-resize"),p&&i.css("cursor","s-resize")):n?i.css("cursor","se-resize"):i.css("cursor",""))}function J(a){A&&(B=!1,E(a,c.get(0).initX,c.get(0).initY)),l?E(a,c.get(0).initX,c.get(0).initY):m?F(a):p?E(a,c.get(0).initX,c.get(0).initY+c.get(0).tempWH):q?E(a,c.get(0).initX+c.get(0).tempWH,c.get(0).initY+c.get(0).tempWH):o?E(a,c.get(0).initX+c.get(0).tempWH,c.get(0).initY):n&&E(a,c.get(0).initX,c.get(0).initY),k>0&&I(a)}function K(){B&&(c.data("imgcrop_bg").hide(),c.data("imgcrop").hide(),c.data("imgcrop_border").hide(),k=0),B=!1,A=!1,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,i.css("cursor","").css("user-select","").off("selectstart"),a.isFunction(f.onSelectEnd)&&f.onSelectEnd.apply(c,[])}function L(){if(h.on("mousedown."+c.propertyName,H),h.on("mouseup."+c.propertyName,K),h.on("mousemove."+c.propertyName,J),c.data("imgcrop_p01").mousedown(function(){q=!0}),c.data("imgcrop_p02").mousedown(function(){p=!0}),c.data("imgcrop_p03").mousedown(function(){p=!0}),c.data("imgcrop_p04").mousedown(function(){o=!0}),c.data("imgcrop_p05").mousedown(function(){n=!0}),c.data("imgcrop_p06").mousedown(function(){o=!0}),c.data("imgcrop_p07").mousedown(function(){n=!0}),c.data("imgcrop_p08").mousedown(function(){n=!0}),f.init){c.data("imgcrop").show(),c.data("imgcrop_border").show(),c.data("imgcrop_bg").show(),x=parseInt(c.data("imgcrop_border").css("borderRightWidth"),10);var b=.8*d(c.width(),c.height()),e=c.offset().top+(c.height()-b>>1),i=c.offset().left+(c.width()-b>>1);c.data("imgcrop_img").width(c.width()),c.data("imgcrop").css({left:i,top:e,width:b,height:b}),c.data("imgcrop_border").css({left:i-x,top:e-x,width:b,height:b}),c.data("imgcrop_bg").css({left:c.offset().left,top:c.offset().top,width:c.width(),height:c.height()}),c.data("imgcrop").children("img").css({top:c.offset().top-c.data("imgcrop").offset().top,left:c.offset().left-c.data("imgcrop").offset().left}),k=b,D()}c.parents().each(function(){"fixed"==a(this).css("position")&&G("fixed")}),g.resize(function(){G("resize")})}function M(){i.append(C),c.data("imgcrop_bg",C.find(".imgcrop-bg")),c.data("imgcrop",C.find(".imgcrop")),c.data("imgcrop_img",C.find(".imgcrop").children("img")),c.data("imgcrop_border",C.find(".imgcrop-border")),c.data("imgcrop_p01",C.find(".imgcrop-point-01")),c.data("imgcrop_p02",C.find(".imgcrop-point-02")),c.data("imgcrop_p03",C.find(".imgcrop-point-03")),c.data("imgcrop_p04",C.find(".imgcrop-point-04")),c.data("imgcrop_p05",C.find(".imgcrop-point-05")),c.data("imgcrop_p06",C.find(".imgcrop-point-06")),c.data("imgcrop_p07",C.find(".imgcrop-point-07")),c.data("imgcrop_p08",C.find(".imgcrop-point-08"));var a=new Image;a.onload=function(){w.imgWid=a.width,w.imgHei=a.height,L()},a.src=j}if(c=a(c),f=a.extend({},this._default,f),!c.hasClass(this.markerClassName)){c.addClass(this.markerClassName);var x,y,z,A,B,g=a(window),h=a(document),i=a("body"),j=c.attr("src"),k=0,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v={},w={},C=a('<div><div class="imgcrop-bg"></div><div class="imgcrop"><img src="'+j+"?v="+Math.random()+'" src="" alt=""></div><div class="imgcrop-border"><span class="imgcrop-point-01"></span><span class="imgcrop-point-02"></span><span class="imgcrop-point-03"></span><span class="imgcrop-point-04"></span><span class="imgcrop-point-05"></span><span class="imgcrop-point-06"></span><span class="imgcrop-point-07"></span><span class="imgcrop-point-08"></span><span class="imgcrop-dashed-01"></span><span class="imgcrop-dashed-02"></span><span class="imgcrop-dashed-03"></span><span class="imgcrop-dashed-04"></span></div></div>');M()}}}),f=a.imgcrop=new g,a.fn.imgcrop=function(a){return this.each(function(){if("string"==typeof a){if(!f["_"+a+"Imgcrop"])throw"Unknown imgcrop method: "+a;f["_"+a+"Imgcrop"].apply(f,[this])}else f._attachImgcrop(this,a||{})})}}(jQuery);